<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>월드플레이 - 인터랙티브 스토리게임 플랫폼</title>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/three.js/build/ar.js"></script>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <script src="gps-camera.js"></script>
    <script src="gps-entity-place.js"></script>
    <script src="gps-camera-debug.js"></script>
    <script src="jsQR.js"></script>
    <script src="qrcodescan.js"></script>
    
    <script>
      window.onload = ()=> {
        navigator.geolocation.getCurrentPosition((position) => {
          document.querySelector('a-plane').setAttribute('gps-entity-place',`latitude:${position.coords.latitude}; longitude:${position.coords.longitude};`)
        });
}
    </script>
    <script>
    window.onload = function () {
      document
        .querySelector(".capture")
        .addEventListener("click", function () {
          // here you can change also a-scene or a-entity properties, like
          // changing your 3D model source, size, position and so on
          // or you can just open links, trigger actions...
           function tick() {

    //loadingMessage.innerText = "⌛ 스캔 기능을 활성화 중입니다."

    if(video.readyState === video.HAVE_ENOUGH_DATA) {

                loadingMessage.hidden = true;
                canvasElement.hidden = false;
                outputContainer.hidden = false;

                // 읽어들이는 비디오 화면의 크기
                canvasElement.height = video.videoHeight;
                canvasElement.width = video.videoWidth;

                canvas.drawImage(video, 0, 0, canvasElement.width, canvasElement.height);
                var imageData = canvas.getImageData(0, 0, canvasElement.width, canvasElement.height);

                var code = jsQR(imageData.data, imageData.width, imageData.height, {

                                  inversionAttempts : "dontInvert",
                });

                            // QR코드 인식에 성공한 경우
                            if(code) {

                                   // 인식한 QR코드의 영역을 감싸는 사용자에게 보여지는 테두리 생성
                                  drawLine(code.location.topLeftCorner, code.location.topRightCorner, "#FF0000");
                                  drawLine(code.location.topRightCorner, code.location.bottomRightCorner, "#FF0000");
                                  drawLine(code.location.bottomRightCorner, code.location.bottomLeftCorner, "#FF0000");
                                  drawLine(code.location.bottomLeftCorner, code.location.topLeftCorner, "#FF0000");

                                  outputMessage.hidden = true;
                                  outputData.parentElement.hidden = false;


                                  // QR코드 메시지 출력
                                 var url = code.data;
                                 //outputData.innerText = code.data;
                                 //location.assign(url); 이것도 된다!! 다만 location.href 보다 느리다더니 정말 이동속도가 느리다.
                                location.href = url;  //아싸 성공이다!!

                                  // return을 써서 함수를 빠져나가면 QR코드 프로그램이 종료된다.
                                  // return;
                            }

                            // QR코드 인식에 실패한 경우
                            else {

                                  outputMessage.hidden = false;
                                  outputData.parentElement.hidden = true;
                            }
                    }

              requestAnimationFrame(tick);
  }
});
tick();
        //window.location.href = "https://tech.worldplay.kr";
          //alert("보물을 획득했다!");
        });
    };
  </script>
    
  <style>
    .buttons {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 5em;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10;
    }

    .capture {
      padding: 0.25em;
      border-radius: 4px;
      border: none;
      background: white;
      color: black;
      width: 4em;
      height: 2em;
    }
  </style>
  </head>
  <body style="margin: 0; overflow: hidden;">
    <div class="buttons">
      <button class="capture">획득하기</button>
    </div>
    <a-scene
      vr-mode-ui="enabled: false"
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false;"
    >
    <a-plane src="채용지원큐알코드.jpg" look-at="[gps-camera]" height="0.9" width="0.9" color="grey" position="-2 1 0" scale="1 1 1"> <!--gps-entity-place="latitude: 37.32223965865335;, longitude: 127.11026595323912;"--></a-plane>
     <!--<a-image>
          look-at="[gps-camera]"
          gps-entity-place="latitude: 37.322384951298595;, longitude: 127.11063726298522;"
          position="0 0 0"
          scale="110 110 110"
          src="정도전초상화.jpg"
          width="3"
          height="3"
        ></a-image>--->
 
      <a-camera gps-camera rotation-reader> </a-camera>
    </a-scene>
  </body>
</html>
